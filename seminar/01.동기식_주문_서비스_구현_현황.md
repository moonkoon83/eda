## 세미나: 점진적으로 구축하는 주문 서비스 - Saga 패턴을 향한 여정

**발표자:** Gemini
**날짜:** 2026-02-03

---

### 1. 프로젝트 목표: 안정적인 주문 서비스 구현

안녕하세요. 오늘 이 자리에서는 **안정적이고 확장 가능한 주문 서비스**를 구축하는 과정을 공유드리고자 합니다.

저희의 최종 목표는 여러 마이크로서비스에 걸친 분산 트랜잭션을 안전하게 처리할 수 있는 **Saga 패턴**을 구현하는 것입니다. 하지만 복잡한 패턴을 한 번에 도입하는 대신, 먼저 **견고한 단일(Monolithic) 동기 방식의 서비스를 구현**하고, 이를 점진적으로 리팩토링하는 전략을 선택했습니다.

이 접근 방식은 각 단계의 안정성을 확보하고, 시스템의 복잡도를 점진적으로 높여나가는 장점이 있습니다.

---

### 2. 1단계: 동기식 처리 방식의 기반 다지기 (현재까지의 진행 상황)

#### 가. 핵심 도메인 모델링
가장 먼저, 주문 시스템의 핵심인 `Order` 도메인을 정의했습니다.

*   `Order` 엔티티: 주문의 상태를 나타내는 `OrderStatus` Enum (`PENDING`, `COMPLETED` 등)과 함께, 비즈니스적으로 유의미하고 유니크한 **주문 번호(`orderNumber`)** 필드를 별도로 추가했습니다. 이는 데이터베이스의 auto-increment ID와 비즈니스 ID를 분리하는 중요한 설계 결정이었습니다.

#### 나. 테스트 주도 개발(TDD)을 통한 신뢰성 확보
저희는 TDD 접근 방식을 채택하여 "요구사항을 코드가 아닌, 실패하는 테스트로 먼저 표현"하는 원칙을 따랐습니다.

*   **주문 번호 생성기 구현 사례:**
    1.  **요구사항:** 주문 번호는 `YYYYMMDDHHMMSS` + 4자리 난수로 구성되며, 절대 중복되어서는 안 된다.
    2.  **테스트 작성 (`OrderNumberGeneratorTest`):** 이 요구사항을 검증하는 테스트 케이스를 먼저 작성했습니다. 이 테스트는 `OrderNumberGenerator`가 없었기 때문에 처음에는 컴파일조차 되지 않았습니다.
    3.  **구현 (`OrderNumberGenerator`):** 테스트를 통과시키기 위한 실제 코드를 작성했습니다. DB 중복 체크 및 재시도 로직을 포함하여 요구사항을 완벽하게 만족시켰습니다.
    4.  **검증:** 단위 테스트와 더불어, 실제 DB와 연동하여 중복 시나리오를 검증하는 통합 테스트(`OrderIntegrationTest`)까지 추가하여 로직의 신뢰도를 극대화했습니다.

#### 다. API 계층 설계
서비스 로직을 외부에서 사용할 수 있도록 API 엔드포인트를 구현했습니다.

*   **`OrderController`:** `POST /orders` 라는 명확한 RESTful 엔드포인트를 생성했습니다.
*   **`CreateOrderRequest` DTO:** 내부 도메인 모델(`Order`)이 외부에 직접 노출되지 않도록, API 요청의 명세를 담는 DTO(Data Transfer Object)를 사용하여 시스템 간의 결합도를 낮췄습니다.

---

### 3. 현재 상태 및 다음 단계

**현재 상태:**
*   고유한 주문 번호를 생성하고, `PENDING` 상태로 데이터베이스에 주문을 저장하는 **동기식 주문 생성 API가 완벽하게 동작**하고 있습니다.
*   단위 테스트와 통합 테스트 모두 통과하여 안정성이 확보된 상태입니다.
*   `http-client/requests.http` 파일을 통해 언제든지 API의 동작을 시연하고 테스트할 수 있습니다.

**다음 단계 로드맵:**
1.  **재고 및 적립금 서비스 연동 (동기):** 현재 `OrderService`에 `StockService`와 `PointService`를 동기적으로 호출하는 로직을 추가하여 완전한 주문 프로세스를 구현할 것입니다.
2.  **Saga 패턴으로의 전환 (비동기):** 동기 방식의 주문 프로세스가 완성되면, 이를 **이벤트 기반의 비동기 방식**으로 리팩토링하여 서비스 간의 결합도를 끊어내는 Saga 패턴 구현을 시작할 것입니다.

---
