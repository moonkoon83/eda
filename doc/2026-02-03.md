## 주문 마이크로 서비스 Saga 패턴 구현 - 진행 상황

### 수정된 작업 계획 (To-Do List)

#### 1단계: 동기식 처리 방식의 주문 서비스 구현

1.  **[완료]** 주문 도메인 및 테스트 케이스 생성
2.  **[완료]** 기본 주문 생성 서비스 구현
3.  **[완료]** 주문 번호 생성 로직 구현 및 테스트
4.  **[완료]** API 엔드포인트 통합
5.  **[진행중]** 재고/적립금 서비스 (동기식) 연동 및 테스트
6.  **[대기중]** 주문 완료 로직 구현
7.  **[대기중]** 주문 실패(재고/적립금 부족) 로직 구현

#### 2단계: Saga 패턴으로 리팩토링

8.  **[대기중]** 이벤트 발행 로직 추가 (Saga 시작)
9.  **[대기중]** 재고/적립금 서비스 리스너 구현 (비동기)
10. **[대기중]** Saga 완료/실패 이벤트 처리
11. **[대기중]** 보상 트랜잭션 구현

---

## 이전 작업 기록

**2026-02-03**

*   **통합 테스트 리팩토링 (`@SpyBean` 제거):**
    *   `@SpyBean`의 deprecation 경고를 해결하기 위해, `OrderIntegrationTest` 내부에 `@TestConfiguration`을 사용하여 Spy Bean을 직접 생성하고 등록하는 방식으로 수정.
*   **테스트 코드 리팩토링:**
    *   헥사고날 아키텍처 구조 변경으로 인해 깨진 테스트 코드들을 수정하는 작업을 시작.
*   **헥사고날 아키텍처 리팩토링 시작:**
    *   사용자 동의 하에, 현재 프로젝트 구조를 헥사고날 아키텍처로 전환하는 작업을 시작.
    *   1단계로 패키지 구조 변경 및 포트(Port) 인터페이스 정의를 진행.
*   **API 호출 문서 (`requests.http`) 생성:**
    *   `http-client` 디렉토리를 생성하고, `/hello` 및 `/orders` 엔드포인트를 호출하는 `requests.http` 파일을 생성.
*   **주문 생성 API 엔드포인트 구현:**
    *   사용자 요청에 따라 `OrderController`와 `CreateOrderRequest` DTO를 새로 생성하여 `POST /orders` API를 구현.
*   **주문 번호 중복 재시도 통합 테스트 추가:**
    *   `OrderIntegrationTest`에 `@SpyBean`을 사용하여 `OrderNumberGenerator`의 재시도 로직을 검증하는 테스트 케이스를 추가하고 통과함을 확인.
*   **`OrderNumberGenerator` 통합:**
    *   `OrderService`가 `OrderNumberGenerator`를 사용하도록 수정.
    *   `OrderServiceTest` 및 `OrderIntegrationTest`에 `orderNumber` 관련 검증 로직 추가 및 테스트 통과 확인.
*   **`OrderNumberGenerator` 구현 및 테스트 통과:**
    *   `OrderNumberGenerator` 클래스를 구현하고, `OrderNumberGeneratorTest`를 실행하여 통과함을 확인.
*   **주문 번호 생성 로직 구현 선행:**
    *   사용자의 요청에 따라 `Stock/Point` 서비스 연동보다 주문 번호 생성 로직을 먼저 구현하기로 결정.
    *   TDD 방식으로 `OrderNumberGenerator`에 대한 실패하는 테스트 케이스를 먼저 작성하고 관련 파일을 수정.
*   **통합/단위 테스트 케이스 추가 및 성공 확인:**
    *   `OrderService`의 DB 연동을 검증하는 `OrderIntegrationTest`와 기본 로직을 검증하는 `OrderServiceTest`를 모두 성공적으로 실행.
*   **기본 도메인 및 서비스 구조 생성:**
    *   `Order`, `OrderStatus`, `OrderRepository`, `OrderService` 등 초기 파일 구조 생성.
*   **Saga 구현 계획 수정:**
    *   사용자 요청에 따라 동기 처리 방식 구현 후 Saga 패턴으로 리팩토링하는 2단계 계획으로 수정.