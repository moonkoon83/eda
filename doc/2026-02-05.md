# 2026년 2월 5일 목요일

## 작업 요약

오늘 진행한 작업은 기존 프로젝트를 Kubernetes 환경에 배포하기 위한 기반을 마련하는 것이었습니다.

### 1. Dockerfile 및 k8s 리소스 생성
- **Dockerfile**: k8s 배포를 위해 멀티-스테이지 빌드(multi-stage build)를 사용하는 `Dockerfile`을 프로젝트 루트에 생성했습니다.
- **k8s 리소스**: `k8s` 디렉토리를 만들고, 그 안에 `namespace.yaml`, `deployment.yaml`, `service.yaml` 파일을 생성하여 애플리케이션 배포 환경을 구성했습니다.

### 2. 빌드 및 배포 스크립트 작성
- **초기 스크립트**: 소스 빌드, 이미지 생성, k8s 배포까지 한 번에 처리하는 `deploy.sh` 스크립트를 작성했습니다.
- **스크립트 개선**: 사용자의 피드백을 반영하여, 빌드와 배포의 책임을 분리했습니다.
  - **`build.sh`**: 소스 코드 컴파일 및 Docker 이미지 빌드 역할.
  - **`deploy.sh`**: k8s 리소스 적용(`apply`) 및 `rollout restart` 명령으로 새로운 이미지를 즉시 반영하도록 수정.

### 3. 프로젝트 구조 정리
- **`scripts` 폴더 생성**: 빌드/배포 관련 스크립트들을 관리하기 위해 `scripts` 폴더를 생성했습니다.
- **파일 이동**: `build.sh`, `deploy.sh`, `run-db.sh` 파일을 `scripts/` 폴더로 이동했습니다.
- **중복 파일 제거**: `build.sh`와 기능이 중복되는 `build-docker-image.sh` 파일을 삭제하여 프로젝트 구조를 정리했습니다.

## 대화 내용

- **Q: 원래 계획은 재고/적립금 서비스 개발을 하려고 했는데, 그전에 현재 프로젝트를 k8s 환경에서 운영하려고 해 dockfile 파일 만들어서 이미지 빌드까지 구현 해줘**
  - A: Dockerfile을 생성하고 `docker build` 명령어로 이미지를 빌드했습니다.

- **Q: dockerfile 만들었으면 이미지 빌드하는 명령어는 sh 으로 만들어줘**
  - A: `build-docker-image.sh` 쉘 스크립트를 생성했습니다.

- **Q: 생성된 도커 이미지로 k8s 에서 어플리케이션을 실행하고자 해 k8s 배포 구성해줘**
  - A: `k8s` 디렉토리와 함께 `namespace`, `deployment`, `service` YAML 파일을 생성했습니다.

- **Q: 소스 빌드 부터 이미지 생성 k8s 배포까지 스크립트를 만들어줘**
  - A: 모든 과정을 자동화하는 `deploy.sh` 스크립트를 생성했습니다.

- **Q: 빌드와 배포는 분리해 주고 apply -f 명령어는 최초 실행일때만 가능한 명령어고 apply 이후에는 yaml 파일 변경이 없으면 변화가 없기 때문에 rollout restart 명령어가 필요해 보이네**
  - A: 지적에 따라 `build.sh`와 `deploy.sh`로 스크립트를 분리하고, `deploy.sh`에 `rollout restart` 명령을 추가했습니다.

- **Q: 배포 빌드 관련된 파일들을 같은 성격끼리 폴더에 합치고 싶은데 어떤 방식을 추천해?**
  - A: `scripts` 폴더를 생성하여 관련 스크립트들을 모으고, 일부 파일은 역할을 고려하여 기존 위치에 두는 방식을 추천드렸고, 동의 하에 실행했습니다.

- **Q: 질문한 내용들을 항상 doc 폴더에 기록을 남겨달라했는데 빼먹었네?**
  - A: 실수를 인정하고 즉시 대화 내용을 정리하여 `doc` 폴더에 기록하는 작업을 수행했습니다.
